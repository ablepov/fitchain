# Fitchain — План разработки (итеративный)

## Принципы
- Малые, законченые инкременты, всегда рабочая сборка.
- Клиент работает через Supabase SDK; безопасность — через RLS.
- Фокус на UX QuickButtons и простоте фиксации подходов.

## Роли и ответственность
- Вы (владелец Supabase/Vercel): создаёте проект, управляете секретами/провайдерами OAuth, запускаете SQL в Supabase.
- Я: разрабатываю код, спецификации, интеграции, проверяю RLS и функционал в UI.

## Что нужно от вас (сейчас)
1. [x] Значения переменных:
   - `NEXT_PUBLIC_SUPABASE_URL`
   - `NEXT_PUBLIC_SUPABASE_ANON_KEY`
2. [x] Доступ к проекту Supabase (read-only достаточно) либо выполнение SQL из README → раздел «SQL миграции и RLS».
3. [ ] (Опционально, позже) Включение Google OAuth в Supabase Auth, если потребуется социальный логин.

> Самопроверки: на ключевых этапах выполняю сценарии проверки в MCP Playwright (на стороне Cursor), без добавления тестовой инфраструктуры в репозиторий.

## Этап 1 — Инициализация и инфраструктура
1. [x] Создать `lib/supabaseClient.ts` (инициализация клиента из `NEXT_PUBLIC_...`).
2. [x] Добавить `lib/types.ts` (базовые интерфейсы: Profile, Exercise, Set, ApiError).
3. [x] Создать каркас `app/api/sets/route.ts` с методами POST/GET (валидация входа, заглушки) → заменено на полноценный API в Этапе 4.
4. [x] Ввести базовую навигацию `app/dashboard/page.tsx` (заглушка UI). 
5. [x] Заполнить `.env.local` указанными переменными (или в Vercel — Environment Variables).
6. [x] Проверить сборку и локальный запуск. [MCP Playwright: smoke‑проверка / и главной страницы]

## Этап 2 — Auth и профиль
1. [x] Добавить Supabase Auth (email/password) на `app/auth` (sign-in, sign-up, sign-out).
2. [ ] (Опционально) Включить провайдера Google OAuth в Supabase (если нужен).
3. [x] При первом логине — ensure `profiles` запись (upsert по `auth.uid()`).
4. [x] Настройка таймзоны в профиле (UI селект). [MCP Playwright: сценарий логина и редиректа]

## Этап 3 — Модель упражнений
1. [x] UI создания 3 упражнений (pullups/pushups/squats) с целями.
2. [x] Список карточек `ExerciseCard` на `dashboard` (данные из `exercises`).
3. [x] Валидации целей (>0), ошибки в UI.

## Этап 4 — Sets API и данные
1. [x] `POST /api/sets`: валидация `reps ∈ [1,1000]`, `source`, `exerciseId`.
2. [x] `GET /api/sets`: фильтр по `exercise|exerciseId`, `limit`, `from/to`, сортировка DESC.
3. [x] `DELETE /api/sets/:id`: мягкое удаление (`deleted_at=now()`).
4. [x] Минимальный rate limit (best‑effort) + клиентский debounce. [MCP Playwright: добавление/удаление подходов]

## Этап 5 — QuickButtons и логика медианы
1. [x] Вычисление медианы по последним 20 подходам (если <20 — по доступным).
2. [x] Кнопки `[+2] [+4] [+6]` относительно медианы; дефолты `[+3] [+5] [+8]`.
3. [x] UI `QuickButtons` + быстрый инкремент подходов по клику.
4. [x] Плавные состояния (loading/success/error), защита от даблкликов. [MCP Playwright: быстрые нажатия и адаптация]

## Этап 6 — Визуализация и сводка
1. [ ] Мини-график последних подходов (SVG/Canvas без тяжёлых зависимостей).
2. [ ] `SummaryPanel`: сумма за день, прогресс к цели, streak.
3. [ ] Эмоциональная подсказка: время с последнего подхода. [MCP Playwright: базовые проверки сводки]

## Этап 7 — Полировка и доступность
1. [ ] Скелетоны/лоадеры, пустые состояния, aria‑лейблы, клавиатура.
2. [ ] Ошибки/валидации с понятными текстами.
3. [ ] Мобильные брейкпоинты. [MCP Playwright: smoke на мобильных вьюпортах]

## Этап 8 — Техдолг и подготовка к продакшену
1. [ ] Лёгкая телеметрия (клики по QuickButtons), логирование ошибок.
2. [ ] (По необходимости) Регламент очистки soft‑deleted записей в Supabase (ручной SQL раз в N дней).
3. [ ] Документация: обновить README/план, чеклист релиса. [MCP Playwright: финальный проход критического пути]

## Чеклист данных, которые нужны от вас
- `NEXT_PUBLIC_SUPABASE_URL`
- `NEXT_PUBLIC_SUPABASE_ANON_KEY`
- (Позже, опционально) параметры OAuth Google

## Выполнение
- Каждая задача — отдельный PR в `main` с кратким описанием.
- После согласования шага — приступаем к реализации прямо из этого плана.
